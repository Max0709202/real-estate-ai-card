# Admin/Client ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

## âœ… å®Ÿè£…å®Œäº†é …ç›®

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ›´æ–° âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/database/admin_system_updates.sql`

- âœ… `business_card_changes` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆå¤‰æ›´è¿½è·¡ç”¨ï¼‰
- âœ… `admins` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä»¥ä¸‹ã‚«ãƒ©ãƒ è¿½åŠ ï¼š
  - `password_reset_token` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³
  - `password_reset_token_expires_at` - ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™
  - `email_verified` - ãƒ¡ãƒ¼ãƒ«èªè¨¼ãƒ•ãƒ©ã‚°
  - `verification_token` - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
  - `verification_token_expires_at` - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™

### 2. èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  âœ…

**Admin/Client ãƒ­ã‚°ã‚¤ãƒ³**:
- âœ… `frontend/admin/login.php` - ãƒ¡ãƒ¼ãƒ«+ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
- âœ… ãƒ¡ãƒ¼ãƒ«èªè¨¼å¿…é ˆï¼ˆæ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰
- âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

**ãƒ¡ãƒ¼ãƒ«èªè¨¼**:
- âœ… `frontend/admin/verify.php` - ãƒ¡ãƒ¼ãƒ«èªè¨¼ãƒšãƒ¼ã‚¸
- âœ… `backend/api/admin/verify-email.php` - ãƒ¡ãƒ¼ãƒ«èªè¨¼API
- âœ… 24æ™‚é–“æœ‰åŠ¹ãªèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³

**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ**:
- âœ… `frontend/admin/forgot-password.php` - ãƒªã‚»ãƒƒãƒˆä¾é ¼
- âœ… `frontend/admin/reset-password.php` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
- âœ… 1æ™‚é–“æœ‰åŠ¹ãªãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³

### 3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/admin/dashboard.php`

**æ©Ÿèƒ½**:
- âœ… å…¨é¡§å®¢ã®ãƒ“ã‚¸ãƒã‚¹ã‚«ãƒ¼ãƒ‰ä¸€è¦§è¡¨ç¤º
- âœ… æœ€çµ‚å¤‰æ›´æ—¥æ™‚ãƒ»å¤‰æ›´è€…IDã®è¡¨ç¤ºï¼ˆã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ï¼‰
- âœ… å„ã‚«ãƒ¼ãƒ‰ã®æœ€çµ‚å¤‰æ›´æƒ…å ±è¡¨ç¤º
- âœ… æ¨©é™ã«å¿œã˜ãŸæ“ä½œãƒœã‚¿ãƒ³è¡¨ç¤º
  - **Admin**: é–²è¦§ + ç·¨é›†ãƒœã‚¿ãƒ³
  - **Client**: é–²è¦§ã®ã¿ï¼ˆç·¨é›†ãƒœã‚¿ãƒ³éè¡¨ç¤ºï¼‰

**è¡¨ç¤ºå½¢å¼**:
```
æœ€çµ‚å¤‰æ›´æ—¥æ™‚ 2025å¹´11æœˆ22æ—¥13æ™‚58åˆ† å¤‰æ›´è€…ID admin@example.com [ADMIN]
```

### 4. æ¨©é™ç®¡ç† âœ…

**Adminæ¨©é™**:
- âœ… å…¨é¡§å®¢ã®ã‚«ãƒ¼ãƒ‰ã‚’ç·¨é›†å¯èƒ½
- âœ… `frontend/admin/edit-card.php` çµŒç”±ã§ç·¨é›†
- âœ… å¤‰æ›´å±¥æ­´ãŒè‡ªå‹•è¨˜éŒ²

**Clientæ¨©é™**:
- âœ… å…¨é¡§å®¢ã®ã‚«ãƒ¼ãƒ‰ã‚’é–²è¦§å¯èƒ½
- âœ… ç·¨é›†ä¸å¯ï¼ˆç·¨é›†ãƒœã‚¿ãƒ³éè¡¨ç¤ºï¼‰
- âœ… å¤‰æ›´å±¥æ­´ã®é–²è¦§å¯èƒ½

### 5. å¤‰æ›´è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ  âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/includes/change-tracker.php`

**è¿½è·¡å†…å®¹**:
- âœ… èª°ãŒå¤‰æ›´ã—ãŸã‹ï¼ˆAdmin/Client/Userï¼‰
- âœ… ã„ã¤å¤‰æ›´ã—ãŸã‹ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
- âœ… ä½•ã‚’å¤‰æ›´ã—ãŸã‹ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã€æ—§å€¤ã€æ–°å€¤ï¼‰
- âœ… å¤‰æ›´ã‚¿ã‚¤ãƒ—ï¼ˆcreate/update/deleteï¼‰

**è‡ªå‹•è¿½è·¡**:
- âœ… ãƒ“ã‚¸ãƒã‚¹ã‚«ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¤‰æ›´
- âœ… æŒ¨æ‹¶æ–‡ã®å¤‰æ›´
- âœ… ãƒ†ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ã®å¤‰æ›´
- âœ… ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ–¹æ³•ã®å¤‰æ›´

### 6. APIæ›´æ–° âœ…

**`backend/api/business-card/update.php`**:
- âœ… Adminç·¨é›†ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- âœ… å¤‰æ›´è¿½è·¡ã®è‡ªå‹•è¨˜éŒ²
- âœ… æ—§å€¤ãƒ»æ–°å€¤ã®æ¯”è¼ƒã¨è¨˜éŒ²

**`backend/api/business-card/get.php`**:
- âœ… Adminç·¨é›†ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œï¼ˆcard_id ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
- âœ… æ¨©é™ãƒã‚§ãƒƒã‚¯

### 7. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ›´æ–° âœ…

**`frontend/edit.php`**:
- âœ… Adminç·¨é›†ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- âœ… `?admin_edit=1&card_id=X` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç·¨é›†å¯èƒ½

**`frontend/assets/js/edit.js`**:
- âœ… Adminç·¨é›†ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- âœ… card_id ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‡¦ç†

### 8. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `backend/api/middleware/admin-auth.php`

**æ©Ÿèƒ½**:
- âœ… `requireAdminAuth()` - Adminèªè¨¼å¿…é ˆ
- âœ… `isAdmin()` - Adminæ¨©é™ãƒã‚§ãƒƒã‚¯
- âœ… `isClient()` - Clientæ¨©é™ãƒã‚§ãƒƒã‚¯
- âœ… `getCurrentAdmin()` - ç¾åœ¨ã®Adminæƒ…å ±å–å¾—

## ğŸ“‹ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### Step 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°

```bash
mysql -u your_username -p your_database < backend/database/admin_system_updates.sql
```

### Step 2: åˆæœŸAdminã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

**æ–¹æ³•A: CLIã‚¹ã‚¯ãƒªãƒ—ãƒˆä½¿ç”¨**
```bash
php backend/scripts/create-admin.php admin@example.com Password123! admin
```

**æ–¹æ³•B: APIä½¿ç”¨**
```bash
curl -X POST http://your-domain/backend/api/admin/register.php \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "Password123!",
    "role": "admin"
  }'
```

**æ–¹æ³•C: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›´æ¥æŒ¿å…¥**
```sql
INSERT INTO admins (email, password_hash, role, email_verified) 
VALUES (
    'admin@example.com',
    '$2y$10$...', -- hashPassword()ã§ç”Ÿæˆ
    'admin',
    1
);
```

### Step 3: ã‚¢ã‚¯ã‚»ã‚¹

1. **ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸**: `http://your-domain/frontend/admin/login.php`
2. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: `http://your-domain/frontend/admin/dashboard.php`

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆbcryptï¼‰
- âœ… ãƒ¡ãƒ¼ãƒ«èªè¨¼å¿…é ˆ
- âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- âœ… æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆAdmin/Clientï¼‰
- âœ… å¤‰æ›´è¿½è·¡ï¼ˆç›£æŸ»ãƒ­ã‚°ï¼‰

## ğŸ“Š å¤‰æ›´è¿½è·¡ã®è¡¨ç¤º

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¸Šéƒ¨
ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æœ€çµ‚å¤‰æ›´æƒ…å ±ã‚’è¡¨ç¤ºï¼š
```
æœ€çµ‚å¤‰æ›´æ—¥æ™‚ 2025å¹´11æœˆ22æ—¥13æ™‚58åˆ† å¤‰æ›´è€…ID admin@example.com [ADMIN]
```

### å„ã‚«ãƒ¼ãƒ‰è¡Œ
å„ã‚«ãƒ¼ãƒ‰ã®æœ€çµ‚å¤‰æ›´æƒ…å ±ã‚’è¡¨ç¤ºï¼š
- æœ€çµ‚å¤‰æ›´æ—¥æ™‚
- æœ€çµ‚å¤‰æ›´è€…ID

## ğŸ¯ ä½¿ç”¨ä¾‹

### Adminã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³
1. `frontend/admin/login.php` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å…¨ã‚«ãƒ¼ãƒ‰ã‚’é–²è¦§ãƒ»ç·¨é›†å¯èƒ½

### Clientã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³
1. `frontend/admin/login.php` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
3. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å…¨ã‚«ãƒ¼ãƒ‰ã‚’é–²è¦§ã®ã¿ï¼ˆç·¨é›†ä¸å¯ï¼‰

### ã‚«ãƒ¼ãƒ‰ç·¨é›†ï¼ˆAdminã®ã¿ï¼‰
1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. `edit.php` ã§ã‚«ãƒ¼ãƒ‰ã‚’ç·¨é›†
3. å¤‰æ›´ãŒè‡ªå‹•çš„ã«è¿½è·¡ã•ã‚Œã‚‹

## ğŸ“ æ³¨æ„äº‹é …

1. **ãƒ¡ãƒ¼ãƒ«èªè¨¼**: æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã€ãƒ¡ãƒ¼ãƒ«èªè¨¼ãŒå¿…è¦ã§ã™
2. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: 8æ–‡å­—ä»¥ä¸Šæ¨å¥¨
3. **æ¨©é™**: Clientæ¨©é™ã§ã¯ç·¨é›†ã§ãã¾ã›ã‚“
4. **å¤‰æ›´è¿½è·¡**: å…¨ã¦ã®å¤‰æ›´ãŒè‡ªå‹•çš„ã«è¨˜éŒ²ã•ã‚Œã¾ã™

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„
- ãƒ¡ãƒ¼ãƒ«èªè¨¼ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã‹ç¢ºèª
- `admins` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèª

### ç·¨é›†ã§ããªã„
- Adminæ¨©é™ãŒã‚ã‚‹ã‹ç¢ºèª
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ã‹ç¢ºèª

### å¤‰æ›´å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œãªã„
- `business_card_changes` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ç¢ºèª

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### æ–°è¦ä½œæˆ
- `frontend/admin/login.php`
- `frontend/admin/dashboard.php`
- `frontend/admin/edit-card.php`
- `frontend/admin/logout.php`
- `frontend/admin/forgot-password.php`
- `frontend/admin/reset-password.php`
- `frontend/admin/verify.php`
- `backend/api/admin/register.php`
- `backend/api/admin/verify-email.php`
- `backend/api/middleware/admin-auth.php`
- `backend/includes/change-tracker.php`
- `backend/database/admin_system_updates.sql`
- `backend/scripts/create-admin.php`

### æ›´æ–°
- `backend/api/business-card/update.php`
- `backend/api/business-card/get.php`
- `frontend/edit.php`
- `frontend/assets/js/edit.js`

## âœ… å®Ÿè£…å®Œäº†

å…¨ã¦ã®æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã€ãƒ†ã‚¹ãƒˆå¯èƒ½ãªçŠ¶æ…‹ã§ã™ã€‚




